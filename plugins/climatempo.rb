require 'open-uri'
require 'nokogiri'
require 'net/http'


@cidades = {
0 => "São Paulo",
1 => "Cruzeiro do Sul",
2 => "Feijó",
3 => "Mâncio Lima",
4 => "Plácido de Castro",
5 => "Porto Acre",
6 => "Rio Branco",
7 => "Tarauacá",
8 => "Maceió",
9 => "Alvarães",
10 => "Barcelos",
11 => "Benjamin Constant",
12 => "Boca do Acre",
13 => "Borba",
14 => "Caapiranga",
15 => "Canutama",
16 => "Carvoeiro",
17 => "Codajás",
18 => "Fonte Boa",
19 => "Humaitá",
20 => "Itacoatiara",
21 => "Itapiranga",
22 => "Juruá",
23 => "Lábrea",
24 => "Manacapuru",
25 => "Manaus",
26 => "Manicoré",
27 => "Maués",
28 => "Moura",
29 => "Novo Aripuanã",
30 => "Novo Airão",
31 => "Parintins",
32 => "Pauini",
33 => "São Gabriel da Cachoeira",
34 => "Tapauá",
35 => "Tefé",
36 => "Tupuruquara",
37 => "Amapá",
38 => "Calçoene",
39 => "Macapá",
40 => "Mazagão",
41 => "Oiapoque",
42 => "Barreiras",
43 => "Bom Jesus da Lapa",
44 => "Caetité",
45 => "Canavieiras",
46 => "Caravelas",
47 => "Carinhanha",
48 => "Cipó",
49 => "Ilhéus",
50 => "Irecê",
51 => "Jacobina",
52 => "Morro do Chapéu",
53 => "Paulo Afonso",
54 => "Porto Seguro",
55 => "Remanso",
56 => "Salvador",
57 => "Senhor do Bonfim",
58 => "Trancoso",
59 => "Vitória da Conquista",
60 => "Fortaleza",
61 => "Brasília",
62 => "Alegre",
63 => "Aracruz",
64 => "Baixo Guandu",
65 => "Barra de São Francisco",
66 => "Cachoeiro de Itapemirim",
67 => "Castelo",
68 => "Colatina",
69 => "Ecoporanga",
70 => "Guarapari",
71 => "Itaguaçu",
72 => "Itaquari",
73 => "Iúna",
74 => "João Neiva",
75 => "Linhares",
76 => "Marataizes",
77 => "Nova Venécia",
78 => "Rio Bananal",
79 => "Santa Leopoldina",
80 => "Serra",
81 => "São Gabriel da Palha",
82 => "São Mateus",
83 => "Vila Velha",
84 => "Vitória",
85 => "Anápolis",
86 => "Aragarças",
87 => "Catalão",
88 => "Goiânia",
89 => "Ipameri",
90 => "Rio Verde",
91 => "Barra do Corda",
92 => "Carolina",
93 => "Imperatriz",
94 => "São Luís",
95 => "Abaeté",
97 => "Aimorés",
98 => "Alfenas",
99 => "Almenara",
100 => "Alpinópolis",
101 => "Araxá",
102 => "Araçuaí",
103 => "Arinos",
104 => "Açucena",
105 => "Bambuí",
106 => "Barbacena",
107 => "Belo Horizonte",
108 => "Betim",
109 => "Boa Esperança",
110 => "Bocaiúva",
111 => "Bom Despacho",
112 => "Botelhos",
113 => "Brasília de Minas",
114 => "Buritis",
115 => "Buritizeiro",
116 => "Caeté",
117 => "Campestre",
118 => "Campo Belo",
119 => "Caparaó",
120 => "Capelinha",
121 => "Carangola",
122 => "Caratinga",
123 => "Carbonita",
124 => "Carmo da Cachoeira",
125 => "Carmo do Rio Claro",
126 => "Cataguases",
127 => "Cordisburgo",
128 => "Congonhas",
129 => "Conselheiro Lafaiete",
130 => "Contagem",
131 => "Coração de Jesus",
132 => "Corinto",
133 => "Coronel Fabriciano",
134 => "Curvelo",
135 => "Diamantina",
136 => "Divinópolis",
137 => "Espinosa",
138 => "Formoso",
139 => "Francisco Sá",
140 => "Governador Valadares",
141 => "Grão Mogol",
142 => "Ibiaí",
143 => "Inhapim",
144 => "Ipatinga",
145 => "Itabira",
146 => "Itamarandiba",
147 => "Itaobim",
148 => "Itaúna",
149 => "Januária",
150 => "Jequitinhonha",
151 => "João Pinheiro",
152 => "Juiz de Fora",
153 => "Lagoa Santa",
154 => "Lavras",
155 => "Machado",
156 => "Malacacheta",
157 => "Manga",
158 => "Manhuaçu",
159 => "Mantena",
160 => "Mariana",
161 => "Medina",
162 => "Minas Novas",
163 => "Monte Azul",
164 => "Montes Claros",
165 => "Muriaé",
166 => "Mutum",
168 => "Nova Lima",
169 => "Novo Cruzeiro",
170 => "Ouro Preto",
171 => "Paracatu",
172 => "Pará de Minas",
173 => "Patos de Minas",
174 => "Pedra Azul",
175 => "Piedade do Rio Grande",
176 => "Pirapora",
177 => "Pitangui",
178 => "Pompéu",
179 => "Ponte Nova",
180 => "Porteirinha",
181 => "Poço Fundo",
182 => "Poços de Caldas",
183 => "Raul Soares",
184 => "Ribeirão das Neves",
185 => "Rio Pardo de Minas",
186 => "Sabará",
187 => "Salinas",
188 => "Santa Luzia",
189 => "Sete Lagoas",
190 => "Silvianópolis",
191 => "São Francisco",
192 => "São João da Ponte",
193 => "São João del Rei",
195 => "Teófilo Otoni",
196 => "Timóteo",
197 => "Tiradentes",
198 => "Três Corações",
199 => "Três Marias",
200 => "Três Pontas",
201 => "Turmalina",
202 => "Uberaba",
203 => "Uberlândia",
204 => "Ubá",
205 => "Unaí",
206 => "Varginha",
207 => "Vespasiano",
208 => "Virgem da Lapa",
209 => "Visconde do Rio Branco",
210 => "Viçosa",
211 => "Águas Formosas",
212 => "Campo Grande",
213 => "Dourados",
214 => "Ivinhema",
215 => "Paranaíba",
216 => "Três Lagoas",
217 => "Alta Floresta",
218 => "Cuiabá",
219 => "Diamantino",
220 => "Nova Xavantina",
221 => "Poxoréo",
222 => "Rondonópolis",
223 => "Tangará da Serra",
224 => "Vera",
225 => "Afuá",
226 => "Alenquer",
227 => "Almeirim",
228 => "Altamira",
229 => "Ananindeua",
230 => "Belo Monte",
231 => "Belterra",
232 => "Belém",
233 => "Bragança",
234 => "Capanema",
235 => "Castanhal",
236 => "Conceição do Araguaia",
237 => "Curuçá",
238 => "Gurupá",
239 => "Igarapé-Açu",
240 => "Itaituba",
241 => "Jacareacanga",
242 => "Juruti",
243 => "Monte Alegre",
244 => "Oriximiná",
245 => "Porto de Moz",
246 => "Prainha",
247 => "São Caetano de Odivelas",
248 => "Salvaterra",
249 => "Santarém",
250 => "Senador José Porfírio",
251 => "Soure",
252 => "Tracuateua",
253 => "Viseu",
254 => "Óbidos",
255 => "Campina Grande",
256 => "João Pessoa",
257 => "Garanhuns",
258 => "Petrolina",
259 => "Recife",
260 => "Bom Jesus",
261 => "Floriano",
262 => "Paulistana",
263 => "Picos",
264 => "Teresina",
265 => "Andirá",
266 => "Arapongas",
268 => "Cascavel",
269 => "Castro",
270 => "Cianorte",
271 => "Curitiba",
272 => "Foz do Iguaçu",
273 => "Guarapuava",
274 => "Irati",
275 => "Ivaí",
276 => "Jacarezinho",
277 => "Londrina",
278 => "Maringá",
279 => "Ponta Grossa",
280 => "Santo Antônio da Platina",
285 => "Araruama",
287 => "Barra Mansa",
288 => "Barra do Piraí",
289 => "Belford Roxo",
291 => "Búzios",
292 => "Cabo Frio",
294 => "Cantagalo",
296 => "Cordeiro",
297 => "Duque de Caxias",
298 => "Guarus",
299 => "Ipiíba",
300 => "Itaboraí",
301 => "Itaguaí",
302 => "Itaperuna",
303 => "Itatiaia",
304 => "Macaé",
305 => "Macuco",
306 => "Magé",
307 => "Mangaratiba",
308 => "Marambaia",
309 => "Maricá",
310 => "Mesquita",
311 => "Neves",
312 => "Nilópolis",
313 => "Niterói",
314 => "Nova Friburgo",
315 => "Nova Iguaçu",
316 => "Penedo",
317 => "Petrópolis",
318 => "Queimados",
319 => "Resende",
320 => "Rio das Ostras",
321 => "Rio de Janeiro",
322 => "Santo Antônio de Pádua",
323 => "Saquarema",
324 => "São Fidélis",
325 => "São Gonçalo",
326 => "São João da Barra",
327 => "São João de Meriti",
328 => "São Pedro da Aldeia",
329 => "Teresópolis",
330 => "Três Rios",
331 => "Vassouras",
332 => "Volta Redonda",
333 => "Mossoró",
334 => "Natal",
335 => "Ariquemes",
336 => "Cacoal",
337 => "Colorado do Oeste",
338 => "Guajará-Mirim",
339 => "Jaru",
340 => "Ji-Paraná",
341 => "Ouro Preto do Oeste",
342 => "Pimenta Bueno",
343 => "Porto Velho",
344 => "Presidente Médici",
345 => "Rolim de Moura",
346 => "Vilhena",
347 => "Boa Vista",
348 => "Caracaraí",
349 => "Bagé",
350 => "Bento Gonçalves",
351 => "Bom Jesus",
352 => "Capão da Canoa",
353 => "Caxias do Sul",
354 => "Cruz Alta",
355 => "Encruzilhada do Sul",
356 => "Farroupilha",
357 => "Gravataí",
358 => "Iraí",
359 => "Lagoa Vermelha",
360 => "Novo Hamburgo",
361 => "Passo Fundo",
362 => "Pelotas",
363 => "Porto Alegre",
364 => "Rio Grande",
365 => "Santa Cruz do Sul",
367 => "Santa Vitória do Palmar",
368 => "São Gabriel",
369 => "São Luiz Gonzaga",
370 => "Torres",
371 => "Uruguaiana",
372 => "Blumenau",
373 => "Campos Novos",
374 => "Chapecó",
375 => "Concórdia",
376 => "Criciúma",
377 => "Florianópolis",
378 => "Indaial",
379 => "Jaraguá do Sul",
380 => "Joaçaba",
381 => "Joinville",
382 => "Lages",
383 => "São Joaquim",
384 => "Aracaju",
385 => "Itabaianinha",
386 => "Propriá",
387 => "Adamantina",
388 => "Aguaí",
390 => "Alumínio",
391 => "Americana",
392 => "Amparo",
393 => "Andradina",
394 => "Angatuba",
395 => "Aparecida",
396 => "Apiaí",
397 => "Araraquara",
398 => "Araçatuba",
399 => "Araçoiaba da Serra",
400 => "Arujá",
401 => "Assis",
402 => "Atibaia",
403 => "Avaré",
404 => "Barretos",
405 => "Barueri",
406 => "Bauru",
407 => "Bebedouro",
408 => "Birigui",
409 => "Boituva",
410 => "Botucatu",
411 => "Bragança Paulista",
412 => "Brotas",
413 => "Buri",
414 => "Cabreúva",
415 => "Cachoeira Paulista",
416 => "Caieiras",
417 => "Campina do Monte Alegre",
418 => "Campinas",
419 => "Campo Limpo Paulista",
421 => "Capela do Alto",
422 => "Capivari",
423 => "Capão Bonito",
424 => "Carapicuíba",
425 => "Casa Branca",
427 => "Caçapava",
428 => "Cerqueira César",
429 => "Cerquilho",
430 => "Cesário Lange",
431 => "Cotia",
432 => "Cruzeiro",
433 => "Cubatão",
434 => "Diadema",
435 => "Dourado",
436 => "Dracena",
437 => "Duartina",
438 => "Embu das Artes",
439 => "Embu-Guaçu",
440 => "Espírito Santo do Pinhal",
441 => "Fernandópolis",
442 => "Ferraz de Vasconcelos",
443 => "Franca",
444 => "Francisco Morato",
445 => "Franco da Rocha",
446 => "Garça",
447 => "General Salgado",
448 => "Guapiara",
449 => "Guaratinguetá",
450 => "Guarulhos",
451 => "Guaíra",
452 => "Ibitinga",
453 => "Ibiúna",
454 => "Iepê",
455 => "Indaiatuba",
456 => "Iperó",
457 => "Itanhaém",
458 => "Itapecerica da Serra",
459 => "Itapetininga",
460 => "Itapeva",
461 => "Itapevi",
462 => "Itatiba",
463 => "Itaí",
464 => "Itu",
465 => "Itupeva",
466 => "Ituverava",
467 => "Itápolis",
468 => "Jaboticabal",
469 => "Jacareí",
470 => "Jales",
472 => "Jumirim",
473 => "Jundiaí",
474 => "Juquitiba",
475 => "Laranjal Paulista",
476 => "Leme",
477 => "Lençóis Paulista",
478 => "Limeira",
479 => "Lindóia",
480 => "Lins",
481 => "Lorena",
482 => "Lucélia",
483 => "Mairinque",
484 => "Mairiporã",
485 => "Martinópolis",
486 => "Marília",
487 => "Matão",
488 => "Mauá",
489 => "Mirandópolis",
490 => "Mirassol",
491 => "Mococa",
492 => "Mogi-Guaçu",
493 => "Mogi-Mirim",
494 => "Mogi das Cruzes",
495 => "Nazaré Paulista",
496 => "Novo Horizonte",
497 => "Olímpia",
498 => "Orlândia",
499 => "Osasco",
500 => "Osvaldo Cruz",
501 => "Ourinhos",
502 => "Paraguaçu Paulista",
503 => "Paraibuna",
504 => "Paulínia",
505 => "Pederneiras",
506 => "Penápolis",
507 => "Pereira Barreto",
508 => "Perus",
509 => "Peruíbe",
510 => "Piedade",
511 => "Pilar do Sul",
512 => "Pindamonhangaba",
513 => "Piracicaba",
515 => "Pirajuí",
517 => "Pirassununga",
519 => "Pompéia",
520 => "Porangaba",
521 => "Porto Feliz",
522 => "Porto Ferreira",
523 => "Praia Grande",
524 => "Presidente Prudente",
525 => "Presidente Venceslau",
526 => "Rancharia",
527 => "Regente Feijó",
528 => "Registro",
529 => "Ribeirão Pires",
530 => "Ribeirão Preto",
531 => "Rio Claro",
532 => "Salesópolis",
533 => "Salto",
534 => "Salto de Pirapora",
535 => "Santa Bárbara d'Oeste",
536 => "Santa Isabel",
537 => "Santana de Parnaíba",
538 => "Santo Anastácio",
539 => "Santo André",
540 => "Santos",
541 => "Sarapuí",
542 => "Serra Negra",
543 => "Sertãozinho",
544 => "Sorocaba",
545 => "Sumaré",
546 => "Suzano",
547 => "São Bernardo do Campo",
548 => "São Caetano do Sul",
549 => "São Carlos",
550 => "São Joaquim da Barra",
551 => "São José do Rio Pardo",
552 => "São José do Rio Preto",
553 => "São José dos Campos",
554 => "São João da Boa Vista",
555 => "São Lourenço da Serra",
557 => "São Miguel Arcanjo",
558 => "São Paulo",
559 => "São Roque",
560 => "São Simão",
561 => "São Vicente",
562 => "Taboão da Serra",
563 => "Tapiraí",
564 => "Taquarituba",
565 => "Tatuí",
566 => "Taubaté",
567 => "Teodoro Sampaio",
568 => "Tietê",
570 => "Ubatuba",
571 => "Urupês",
572 => "Valinhos",
573 => "Valparaíso",
574 => "Vargem Grande do Sul",
575 => "Vinhedo",
576 => "Votorantim",
577 => "Votuporanga",
578 => "Várzea Paulista",
579 => "Águas de São Pedro",
580 => "Álvares Machado",
581 => "Araguatins",
582 => "Araguaçu",
583 => "Araguaína",
584 => "Augustinópolis",
585 => "Cristalândia",
586 => "Figueirópolis",
587 => "Filadélfia",
588 => "Formoso do Araguaia",
589 => "Gurupi",
590 => "Miracema do Tocantins",
591 => "Miranorte",
592 => "Natividade",
593 => "Palmas",
594 => "Paranã",
595 => "Pedro Afonso",
596 => "Peixe",
597 => "Ponte Alta do Bom Jesus",
598 => "Porto Nacional",
599 => "Taguatinga",
}



def clima(city)
@previsoes = Hash.new
base = "//body/div[4]/div/div[4]/div/div"
getdata = Nokogiri::HTML(open("http://www.climatempo.com.br/previsao-do-tempo/cidade/#{city}/empty"))
@previsoes[:city] = getdata.xpath("#{base}/h1").text
@previsoes[:temperature] = getdata.xpath("#{base}/div[3]/div/div/ul[2]/li[1]").text
@previsoes[:airhumidity] = getdata.xpath("#{base}/div[3]/div/div/ul[2]/li[2]").text
@previsoes[:hpa] = getdata.xpath("#{base}/div[3]/div/div/ul[2]/li[3]").text
@previsoes[:airvelocity] = getdata.xpath("#{base}/div[3]/div/div/ul[2]/li[4]/a").text.gsub(' ','').gsub("\n",'')
@previsoes[:updated] = getdata.xpath("#{base}/div[3]/div/div/p").text.gsub('Atualizado às ','')
@previsoes[:temperaturenow] = getdata.xpath("#{base}/div[2]/div/p[1]").text
@previsoes[:cloud] = getdata.xpath("#{base}/div[2]/div/p[2]").text
end

def climatempo(message)
	puts "#{Time.now} /climatempo #{message.from.first_name} #{message.from.last_name} => #{message.chat.id}"

	clima(@cidades.key(message.text.gsub("/climatempo ","")))
	return "#{@previsoes[:city]} 
		Temperatura: #{@previsoes[:temperature]} 
		Umidade: #{@previsoes[:airhumidity]} 
		Tempo: #{@previsoes[:cloud]}"
end

# puts climatempo("Belo Horizonte")